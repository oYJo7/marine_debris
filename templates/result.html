<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>RESTful API</title>

<script>
	window.onload = function(){
		var alist = document.getElementById('list').value;
        alist = alist.split("'");
        var aalist = [];
        //aalist: 파일명 모은 배열
        for ( var i = 1; i < alist.length; i+=2 ){ aalist.push(alist[i]); }
		document.getElementById(aalist[0]).click();
	}

    //https://haeeeell.tistory.com/54
    //keydown: 키를 눌렀을 때 발생 
    document.addEventListener("keydown", keyHandler, false);

	function keyHandler(e) {
        var targetID = document.getElementById('targetID').value; //(1, 'FD_10.jpg')
        var alist = document.getElementById('list').value;
        alist = alist.split("'");
        var aalist = [];
        //aalist: 파일명 모은 배열
        for ( var i = 1; i < alist.length; i+=2 ){ aalist.push(alist[i]); }

        var targetID = targetID.split("'");
        var targetID = targetID[0];
        
        if( targetID.length == 4){
            targetID = targetID.slice(1,2); //1의 자리
        } else if ( targetID.length == 5) {
            targetID = targetID.slice(1,3); //10의 자리
        } else if ( targetID.length == 6) {
            targetID = targetID.slice(1,4); //100의 자리
        } else if ( targetID.length == 7) {
            targetID = targetID.slice(1,5); //1,000의 자리
        } else if ( targetID.length == 8) {
            targetID = targetID.slice(1,6); //10,000의 자리
        } else if ( targetID.length == 9) {
            targetID = targetID.slice(1,7); //100,000의 자리
        }
        
        targetID = Number(targetID);

        console.log('targetID: ', targetID); //targetID: 2 -> targetID+1: 3 , targetID: 2 -> targetID-1: 1
        console.log('aalist[targetID]: ', aalist[targetID]); //aalist[2] aalist[targetID] -> aalist[3] aalist[targetID+1], aalist[2] aalist[targetID] -> aalist[1] aalist[targetID-1]

        //아래로(오른쪽 방향키)
        if(e.key == 37 || e.key == "ArrowRight") {
            console.log('right key');
            
            var aaaa = "("+(targetID+1)+", '"+aalist[targetID]+"')";
      
            document.getElementById('ImagePath').value=aalist[targetID+1];
            document.getElementById('targetID').value=aaaa;

            const abab = document.getElementById(aaaa);
            getReserveInfo(abab, aaaa);

            const myForm = document.getElementById("ImagePrint");
            myForm.submit();
        }
        //위로(왼쪽 방향키)
        else if(e.key == 39 || e.key == "ArrowLeft") {
            console.log('left key');

            var aaaa = "("+(targetID-1)+", '"+aalist[targetID-2]+"')";

            document.getElementById('ImagePath').value=aalist[targetID-2];
            document.getElementById('targetID').value=aaaa;

            const abab = document.getElementById(aaaa);
            getReserveInfo(abab, aaaa);

            const myForm = document.getElementById("ImagePrint");
		    myForm.submit();
        }
	}

    function RightBtn() {
        var targetID = document.getElementById('targetID').value; //(1, 'FD_10.jpg')
        var alist = document.getElementById('list').value;
        alist = alist.split("'");
        var aalist = [];
        //aalist: 파일명 모은 배열
        for ( var i = 1; i < alist.length; i+=2 ){ aalist.push(alist[i]); }

		console.log('targetID: ', targetID);
        var targetID = targetID.split("'");
		console.log('targetID: ', targetID);
        var targetID = targetID[0];
        
        if( targetID.length == 4){
            targetID = targetID.slice(1,2); //1의 자리
        } else if ( targetID.length == 5) {
            targetID = targetID.slice(1,3); //10의 자리
        } else if ( targetID.length == 6) {
            targetID = targetID.slice(1,4); //100의 자리
        } else if ( targetID.length == 7) {
            targetID = targetID.slice(1,5); //1,000의 자리
        } else if ( targetID.length == 8) {
            targetID = targetID.slice(1,6); //10,000의 자리
        } else if ( targetID.length == 9) {
            targetID = targetID.slice(1,7); //100,000의 자리
        }
        
        targetID = Number(targetID);

        console.log('targetID: ', targetID); //targetID: 2 -> targetID+1: 3 , targetID: 2 -> targetID-1: 1
        console.log('aalist[targetID]: ', aalist[targetID]); //aalist[2] aalist[targetID] -> aalist[3] aalist[targetID+1], aalist[2] aalist[targetID] -> aalist[1] aalist[targetID-1]
        console.log('right Btn');
            
        var aaaa = "("+(targetID+1)+", '"+aalist[targetID]+"')";
    
        document.getElementById('ImagePath').value=aalist[targetID+1];
        document.getElementById('targetID').value=aaaa;

        const abab = document.getElementById(aaaa);
        getReserveInfo(abab, aaaa);

        const myForm = document.getElementById("ImagePrint");
        myForm.submit();
    }
    function LeftBtn() {
        var targetID = document.getElementById('targetID').value; //(1, 'FD_10.jpg')
        var alist = document.getElementById('list').value;
        alist = alist.split("'");
        var aalist = [];
        //aalist: 파일명 모은 배열
        for ( var i = 1; i < alist.length; i+=2 ){ aalist.push(alist[i]); }

        var targetID = targetID.split("'");
        var targetID = targetID[0];
        
        if( targetID.length == 4){
            targetID = targetID.slice(1,2); //1의 자리
        } else if ( targetID.length == 5) {
            targetID = targetID.slice(1,3); //10의 자리
        } else if ( targetID.length == 6) {
            targetID = targetID.slice(1,4); //100의 자리
        } else if ( targetID.length == 7) {
            targetID = targetID.slice(1,5); //1,000의 자리
        } else if ( targetID.length == 8) {
            targetID = targetID.slice(1,6); //10,000의 자리
        } else if ( targetID.length == 9) {
            targetID = targetID.slice(1,7); //100,000의 자리
        }
        
        targetID = Number(targetID);

        console.log('targetID: ', targetID); //targetID: 2 -> targetID+1: 3 , targetID: 2 -> targetID-1: 1
        console.log('aalist[targetID]: ', aalist[targetID]); //aalist[2] aalist[targetID] -> aalist[3] aalist[targetID+1], aalist[2] aalist[targetID] -> aalist[1] aalist[targetID-1]
        console.log('left Btn');

        var aaaa = "("+(targetID-1)+", '"+aalist[targetID-2]+"')";

        document.getElementById('ImagePath').value=aalist[targetID-2];
        document.getElementById('targetID').value=aaaa;

        const abab = document.getElementById(aaaa);
        getReserveInfo(abab, aaaa);

        const myForm = document.getElementById("ImagePrint");
        myForm.submit();

    }

	function getReserveInfo(target, id) {
		var tbody = target.parentNode;
		var trs = tbody.getElementsByTagName('tr');
	 
		var backColor = "#ffffff";
		var textColor = "black";
		var orgBColor = "#20B2AA";
		var orgTColor = "#ffffff";
	 
		var no = "";
		var no1 = "";
        
        //id랑 label 가져오기
        var ilist = id.split("'");
        var ii = ilist[1];
        document.getElementById('ImagePath').value=ii; // FD_1.jpg
        document.getElementById('targetID').value=id; // id: ('FD_1.jpg', 1)

		for ( var i = 0; i < trs.length; i++ ) {
			if ( trs[i] != target ) {
				trs[i].style.backgroundColor = backColor;
				trs[i].style.color = textColor;
			} else {
				trs[i].style.backgroundColor = orgBColor;
				trs[i].style.color = orgTColor;
			};
		};
        const myForm = document.getElementById("ImagePrint");
		myForm.submit();
	}

</script>
</head>

<body>
	<form action="http://localhost/detail" target="iframe2" method = "post" id="ImagePrint">
		<input name = "ImagePath" id = "ImagePath" value = "" type="hidden"/>
	</form>
	<div style="position: fixed; width:auto; overflow: auto; top: 75px; left: 20px; overflow-x: hidden;">
        <table id="testTable" border = "1" class = "table" >
            <thead style="display:block;">
                <tr>
                    <th style="position: sticky; top: 0;">Num</th>
                    <th style="position: sticky; top: 0;">ImagePath</th>
                <tr/>  
            </thead>
            <tbody style="display:block; width:auto; height:557px; overflow:scroll; overflow-x: hidden"> 
                {% for item in ImagePathList %}
                <tr id="{{item}}" onclick="getReserveInfo(this, this.id);">
                    {% for i in item %}
                    <td>
                        <option id="{{i}}">{{i}}</option>
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
	<button onclick="LeftBtn();" style="font-size:300%; position: fixed; width: 80px; height: 80px; top:690px; left: 20px;">◀</button>
    <button onclick="RightBtn();" style="font-size:300%; position: fixed; width: 80px; height: 80px; top:690px; left:140px">▶</button>
	<iframe id="iframe2" name="iframe2" width="1800" height="800" scrolling="no" frameborder=0 style="position: fixed; top: 1px; left: 230px;"></iframe>
	<input name = "targetID" id = "targetID" value = "" type="hidden"/>
	<input name = "list" id = "list" value = "{{ImagePathList}}" type="hidden"/>
</body>
</html>